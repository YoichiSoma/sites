# AWS 開発環境を考える
## 趣旨
- AWSにてIaCや簡単なコード開発をしたい
- 極力ブラウザで完結したい
   - ローカルにはデータを残したくない
   - 通信に制限がる環境であってもブラウザアクセスは許可されていることが多いので
- あまりお金をかけたくない

## どうするのか？
- AWSコンソールにはCLI操作ができる[Cloud Shell](https://docs.aws.amazon.com/ja_jp/cloudshell/latest/userguide/welcome.html)があるのでこれをメインで利用
- Cloudshellだとやりづらい操作(Docker関連やコード開発)は[Cloud9](https://aws.amazon.com/jp/cloud9/)を利用
   - ただし、Cloud9は動かしているだけで料金が発生するので必要に応じて使うようにする

## 事前準備
### AWSアカウント
- これがないと始まらないのでアカウントを作成する
- 作成後必ずMFA設定と複雑なパスワードへ変更する

### IAMアカウント作成
- 作成したAWSアカウント（rootアカウント）は通常利用せずに、IAMアカウントを作成する  
- これはrootアカウントの権限が絶大なのと情報が漏れた場合のリスクが高いためである
- 作成したら必ずMFA設定を行うこと！
- 権限はとりあえず"AdministratorAccess"で、あとは用途に応じて権限を変えていけば良い

---

## 想定構成
- 構成的には以下
![開発環境例](https://user-images.githubusercontent.com/125415634/219527497-29c646da-e4e6-43ea-a143-982ebf3d6811.png)

- CloudShellはIAMアカウントと権限があれば使える
- 今回構築するのはcloud9環境
  - デフォルトのVPC設定でもよいが今回は使いやすくするためVPCから作成していく

## 構築 （VPCまわり）
### デフォルトVPCの削除
- まずは環境をきれいにする
- VPC上にリソースは無いのでVPCの削除で対応できる
### VPC作成
- 適当な大きさのネットワークアドレスで作成
- /16 ぐらいが使いやすいかも
### サブネット作成
- VPCが作成できるとサブネット作成ができるので作成を行う
- デフォルトVPCの場合az-a,az-c,az-dの3つが作成されているが個人開発であれば2つあればまずは問題ないので2つ作成
- /24ぐらいの大きさが使いやすいかも
### インターネットゲートウェイの作成
- cloud9はパブリックIPでのアクセスとなるため、インターネットゲートウェイが必要となる
- 特に設定項目はないので何も考えずに作成
- 作成したらVPCにアタッチする
### ルートテーブルの追加
- ルートテーブルを作成して作成したサブネットを関連付けする
- 作成したインターネットゲートウェイをデフォルトルート（0.0.0.0/0）のターゲットに指定

## 構築 （cloud9）
cloud9の作成で以下を考慮する
- Environment type
   - これは”New EC2 instance”がいいかも
   - 多分専用のIAMイメージがあるのでデプロイが早いのと色々と考える必要がないので
- Network settings > Connection
   - "Secure Shell (SSH)"を選択
     - SSMだとVPCエンドポイントの作成が必要となり、料金がかかるので！
- Network settings > VPC setting
   - 作成したVPCとサブネット（aでもcでもどっちでもいい）を指定する
