# ec2
ec2の利用を設計する際に考慮すべき点は以下である
- インスタンスタイプ
- EBSボリュームの種類とサイズ

それぞれについてざっくりした説明と参考情報リンクを紹介する

---

## [インスタンスタイプ](https://aws.amazon.com/jp/ec2/instance-types/)について

- 利用するワークロードに合わせてインスタンスタイプを選定する
- インスタンスタイプは以下に分かれている

|型|タイプ|用途|CPU|メモリ|ストレージ|ネットワーク帯域|その他|
|---|---|---|---|---|---|---|---|
|M,T系|一般用途向け|バランスの良い構成|普通|普通|EBSのみ|普通|-|
|C系|コンピューティング最適化|高パフォーマンスなCPUを採用|早い|普通|EBSのみ|普通|-|
|R系|メモリ最適化|メモリを使うワークロードに対応|普通|多め|EBSのみ|普通|-|
|P,G系|高速コンピューティング|ハードウェアアクセラレータを利用できる|普通|普通|EBSのみ|普通|GPU等が使える|
|I*,D系|ストレージ最適化|高速なローカルストレージが使える|普通|普通|EBSのみ|普通|NVMeSSDが使える|

- 型のあとに付与される番号は世代
- その後のアルファベットはCPUの種類である
  - g : AWS Graviton (Arm) 
  - a : AMD
  - i : Intel
  - 他色々・・・

### 参考として
WEB,Cache,DB,バッチ処理をEC2で行う場合
- WEB (４コア、８GB位を目安)
  - C系かM系を選択
- DB (8コア、32GB位を目安)
  - R系 （RDSはR系）I系（ローカルストレージで高速に回したい場合）
- Cache (４コア、64GB位を目安)
  - R系
- バッチ (8コア、16GB位を目安) 
  - M系、C系あたり

---

### ストレージ
- EC2にアタッチするEBSボリュームには以下の種類がある
  - SSD
    - gp3 ,gp2
    - io2Block Express, io2, io1
  - HDD
    - st1
    - sc1
- ワークロードに応じて選定すべきだが基本は"gp3"で問題ない
  
#### 参考
- [公式ドキュメント](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ebs-volume-types.html)
- [AWSSUMMIT資料](https://pages.awscloud.com/rs/112-TZM-766/images/AWS-20_AWS_Summit_Online_2020_STG02.pdf)


### 細かい説明
- SSD
  - 汎用SSDボリューム (gp3,gp2)
    - 普通に使う分には"gp3"を選択しておけばよい （コストメリットの観点で）
      - [参考.1](https://blog.serverworks.co.jp/ebs-gp3-vs-gp2)
      - [参考.2](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/general-purpose.html)
  - Provisioned IOPS SSD ボリューム (io2,io1)
    - スループットが大量で、低レイテンシーを必要とするワークロードに利用
      - DBやNoSQLDB等
    - IOPSがかなり大きく設定できる
      - 100000 IOPS (GiB あたり最大 1000 IOPS)、gp3は16000 IOPS
    - その分料金は高い
- HDD
  - スループット最適化 HDD ボリューム (st1)
    - ビッグデータ、データウェアハウス等で利用
  - Cold HDD ボリューム (sc1)
    - バックアップ系？

### どれを選ぶか？
- よほどなことが無い限gp3で問題なし
- 早いストレージが必要であればi系で利用できるNVMeストレージを利用するのも手である
  - ※ただしNVMeストレージはインスタンスを停止した場合データは消えるので注意
    - 過去運用実績としては起動後別のサーバからデータをコピーしてからサービスインといういう運用を行っていた

----

## まとめ
- インスタンスタイプはワークロードに応じて選択する
  - 処理速度か？キャッシュサイズか？ストレージスピードか？
- EBSストレージはよほどなことが無い限りgp3で問題ない
a
